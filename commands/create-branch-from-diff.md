---
allowed-tools: [Bash, Read]
description: 現在の差分を元に新しいブランチを作成してチェックアウトする
---

# 差分ベースブランチ作成

## コンテキスト
- ブランチ名：$ARGUMENTS（省略時は自動生成）
- 現在のワーキングディレクトリの変更を元に新しいブランチを作成
- 変更がある場合のみブランチを作成し、変更をコミットしてからチェックアウト
- ブランチ名が指定されない場合は変更内容から自動生成

## あなたのタスク

### 1. 前提条件の確認

- Gitリポジトリが初期化されていることを確認
- 現在のワーキングディレクトリに変更があることを確認
- 引数でブランチ名が指定されている場合は有効な形式であることを確認

### 2. 現在の状態確認

- `git status`で現在の変更状況を確認
- `git diff`で変更内容を確認
- 変更がない場合はユーザーに通知して処理を終了

### 3. ブランチ名の決定

- 引数が指定されている場合はそれを使用
- 引数が未指定の場合は以下の優先順位で自動生成：
  1. 変更されたファイル名から推測（例：`fix/user-service`, `feature/auth-component`）
  2. コミットメッセージキーワードから推測
  3. フォールバック：`auto/YYYY-MM-DD-HHMMSS`形式
- 生成されたブランチ名をユーザーに確認

### 4. 変更のステージング

- `git add .`で全ての変更をステージングエリアに追加
- ステージングされた変更を再確認

### 5. 新しいブランチの作成とチェックアウト

- 決定されたブランチ名で `git checkout -b [ブランチ名]` を実行
- ブランチ作成の成功を確認
- 既存ブランチ名との重複チェック

### 6. 変更のコミット

- 適切なコミットメッセージで変更をコミット
- コミットの成功を確認

### 7. 結果確認・完了処理

- `git status`で最終状態を確認
- `git branch`で現在のブランチを確認
- ユーザーに作業完了を報告

## 重要注意事項

- ブランチ名は英数字、ハイフン、アンダースコア、スラッシュのみ使用可能
- 既存のブランチ名との重複を避ける
- 変更がない場合は不要なブランチを作成しない
- 自動生成されたブランチ名は必ずユーザーに確認する
- コミット前に変更内容を確認してユーザーに提示
- 現在のブランチがcleanでない場合の適切な処理
- 引数なしでも実行可能であることをユーザーに明示

## 使用例

```bash
# 手動でブランチ名を指定
/create-branch-from-diff feature/user-authentication

# 自動でブランチ名を生成（推奨）
/create-branch-from-diff

# 結果として以下のような流れで実行される：
# 1. 現在の変更を確認
# 2. ブランチ名を決定（手動指定または自動生成）
# 3. 自動生成の場合はユーザーに確認
# 4. git add . で変更をステージング
# 5. git checkout -b [ブランチ名] でブランチ作成
# 6. git commit -m "適切なメッセージ" で変更をコミット
# 7. 新しいブランチに切り替わった状態で完了
```

think hard